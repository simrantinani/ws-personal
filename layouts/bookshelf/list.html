{{ define "main" }}
<main id="main" class="bookshelf">
  <div class="bookshelf-page">

    <header class="bookshelf-hero">
     A catalogue of selected books I've read, loosely grouped by theme, and ordered alphabetically by author names. I put this together mainly as a way to keep a record of the books that left some mark on me. It is not a complete list, but rather what I could recall and chose to share publicly.
 <p>
 </p>       
    </header>

    {{/* ---- Category order + labels ---- */}}
{{ $categoryOrder := slice
      "fiction"
      "science"
      "health"
      "world"
      "childhood"
}}

{{ $categoryLabels := dict
      "health"      "Well-Being & Personal Psychology"
      "fiction"     "Fiction"
      "science"     "(Popular) Science"
      "world"       "Social Science & Interpersonal Psychology"
      "childhood"   "Childhood Favourites"

}}


    {{ $allBooks := site.Data.books }}

    {{ if $allBooks }}

      {{/* ---- Category nav ---- */}}
      <nav class="bookshelf-nav" id="bookshelfNav">
        {{ range $categoryOrder }}
          {{ $key := . }}
          {{ $label := index $categoryLabels $key }}
          <a href="#{{ $key }}">{{ $label }}</a>
        {{ end }}
      </nav>

      <div class="bookshelf-content">
        {{/* ---- Render each category section from data ---- */}}
        {{ range $index, $key := $categoryOrder }}
          {{ $label := index $categoryLabels $key }}
          {{ $booksInCat := where $allBooks "category" $key }}

{{ if gt (len $booksInCat) 0 }}
  <section id="{{ $key }}" class="bookshelf-section">
    <details open>
<summary>
  {{ $label }} <span class="book-count">({{ len $booksInCat }})</span>
</summary>      <ul>
        {{ range sort $booksInCat "author" "title" }}
          <li>
            <span class="book-title">{{ .title }}</span>
            {{ with .author }}
              â€” <span class="book-author">{{ . }}</span>
            {{ end }}
          </li>
        {{ end }}
      </ul>
    </details>
  </section>
{{ end }}
        {{ end }}
      </div>

    {{ else }}

      <p class="bookshelf-empty-state">
        No book data found. Create <code>data/books.yml</code> with entries like:
      </p>
      <pre><code>- title: "Becoming Myself: A Psychiatrist's Memoir"
  author: "Irvin D. Yalom"
  category: "health"</code></pre>

    {{ end }}

  </div>

</main>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const navLinks = document.querySelectorAll(".bookshelf-nav a");
  navLinks.forEach(link => {
    link.addEventListener("click", () => setTimeout(() => link.blur(), 100));
  });

  const input = document.getElementById("bookSearch");
  if (!input) return;

  const sections = document.querySelectorAll(".bookshelf-section");

  input.addEventListener("input", function () {
    const q = this.value.toLowerCase().trim();
    sections.forEach(section => {
      let matchesInSection = false;
      section.querySelectorAll("li").forEach(li => {
        const text = li.textContent.toLowerCase();
        const match = !q || text.includes(q);
        li.style.display = match ? "" : "none";
        if (match) matchesInSection = true;
      });
      section.style.display = matchesInSection ? "" : "none";
    });
  });
});
</script>

{{ end }}
